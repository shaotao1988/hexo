---
layout: post
title: SQL vs NoSQL
description: 
date: 2018-10-31
tags: [数据库]
---

SQL长久以来是存储数据的主要方式，但NoSQL也吸引了越来越多的关注。它们有什么本质的区别？我们该如何选用它们？
<!-- more -->

# SQL和NoSQL之间的战争

首先澄清一些错误的观点。

## 观点一：NoSQL会取代SQL

NoSQL和SQL做同样的事情：存储数据。它们使用不同的方法，可能帮助或者阻碍你的项目。

尽管NoSQL更新并且关注度越来越高，但它并不是SQL的替代品，而是为你提供另一种选择。

## 观点二： NoSQL比SQL好、或者坏

有些项目更适合SQL，有些更适合NoSQL，而有些使用两者皆可。

## 观点三： SQL和NoSQL之间有明显的界限

这并不一定正确。一些SQL正在吸取NoSQL的特性，反之亦然。它们之间的界限正变得越来越模糊，未来很可能出现一种NewSQL。

# SQL和NoSQL的主要区别

## Tables vs Documents

以在线商店储存书本为例，SQL以表格存储，比如：

|  ISBN | Title                    |  Author  | Format  | Price |
| :---: | ------------------------ | -------- | ------- | ----- |
|9567001|Introduction to Javascript| David    | pdf     | 26.00 |
|9567002|Python Cookbook           | Luis     | pdf     | 28.00 |

每一行都是不同书本的记录，无法使用这个表来存储不是书本的信息，并且每一列都有严格的数据类型。

NoSQL存储的是类似JSON的键值对，比如：
```JSON
{
    ISBN: 9567001,
    Title: "Introduction to Javascript",
    Author: "David",
    Format: "pdf",
    Price: 26.00
}
```
你可以以任意类型存储任意数据到NoSQL数据库中。相比较而言，SQL表格定义了严格的数据模板，所以不容易犯错。而NoSQL更灵活，但是存储任意类型的数据容易导致解析时出错。

## SQL Schema和NoSQL Schemaless

SQL数据库在定义表格前无法存储任何数据，表格的格式称作Schema，包含主键、索引、关系、触发器和存储过程等。Schema必须在实现业务逻辑之前定义好，当业务上线后变更Schema会相当困难。

而在NoSQL数据库中，数据可以在任意地方、任意时间点添加，而无需事先定义存储数据的格式。比如下面的语句会创建名称为book的文档：
```python
db.book.insert(
    ISBN: 9567001,
    Title: "Introduction to Javascript",
    Author: "David",
    Format: "pdf",
    Price: 26.00
)
```

NoSQL数据库可能更适合在项目初期数据格式很难确定的场景。但是如果忽略了在项目初期定义好正确的数据格式的重要性，在项目后期可能带来灾难。

## SQL Normalization和NoSQL DeNormalization

范式化保证无数据冗余，更新数据是更简单；反范式增加了数据冗余，在更新冗余数据是很麻烦，但是查询性能更好。

在SQL数据库中，为了获取更好的查询性能，对数据分片时，通常也会适当增加数据冗余来避免跨数据库join

## SQL join vs NoSQL scanning

SQL的join语句可以从多个表中获取相关联的数据，而如果是NoSQL数据库，则必须遍历2个数据库并手动获取关联数据。

## 数据完整性

SQL数据库使用外键对数据完整性加以约束，比如任意一本书籍都要包含出版商信息，同时当删除某个出版商的信息时，只要有任意一本该出版商出版的书籍存在数据库中，删除都无法成功。

NoSQL数据库没有这样的约束，NoSQL中的一条记录包含了关于这条记录的所有信息。

## 事务

SQL数据库具有很成熟的事务支持机制，而NoSQL只能保证单一document中的事务，跨document的事务则无法支持，只能由业务代码实现。

## 性能

由于不需要join和复杂的SQL语句，NoSQL在查询单条记录时性能更好。但是一个设计良好的SQL数据库的综合性能要好于一个设计不良的NoSQL数据库。

## 扩展性

NoSQL的反范式化，使之天生具有良好的扩展性。

## 可用性

SQL数据库更成熟，被广泛使用和验证。而开发者和系统管理员对NoSQL的知识储备并不像SQL那么丰富，所以更容易犯错。

# 总结

SQL和NoSQL数据库用不同的方法做相同的事情。可以在开始时使用一种数据库，之后再切换为另一种，但是事先考虑和规划会节省更多的时间和金钱。

更适合SQL的场景：
- 逻辑相关的离散数据，可以被预先定义和识别
- 事务和数据完整性非常重要
- 根据经验和被业界广泛证明了更适合SQL的场景

更适合NoSQL的场景：
- 不相关的、模糊的、逐步发展的数据
- 简单项目，可以马上启动编码
- 迫切要求速度和可扩展性的项目
